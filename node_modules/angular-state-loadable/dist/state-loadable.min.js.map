{"version":3,"sources":["state-loadable.min.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","angular","factory","run","$loadableManager","$ready","./services/loadable-manager",2,"$state","$q","$rootScope","_head","_self","_loadableHash","_loadingList","_completedList","_Loadable","src","_deferred","defer","_loadable","isComplete","promise","$element","document","createElement","type","async","insertBefore","firstChild","push","onload","onreadystatechange","this","readyState","parentNode","removeChild","indexOf","splice","resolve","_getProgress","loaded","total","Math","min","max","_createLoadable","loadable","error","$broadcast","then","_load","deferred","current","sources","load","all","map","filter","err","reject","$load","get","progress","element","querySelector","$use","request","next","$on","reload"],"mappings":"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","file":"state-loadable.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\n/* global angular:false */\n\n// CommonJS\nif (typeof module !== \"undefined\" && typeof exports !== \"undefined\" && module.exports === exports){\n  module.exports = 'angular-state-loadable';\n}\n\n// Assume polyfill used in StateRouter exists\n\n// Instantiate module\nangular.module('angular-state-loadable', ['angular-state-router'])\n\n  .factory('$loadableManager', require('./services/loadable-manager'))\n\n  .run(['$loadableManager', function($loadableManager) {\n    $loadableManager.$ready();\n  }]);\n\n},{\"./services/loadable-manager\":2}],2:[function(require,module,exports){\n'use strict';\n\n/* global document:false */\n\nmodule.exports = ['$state', '$q', '$rootScope', function($state, $q, $rootScope) {\n\n  // DOM target\n  var _head;\n\n  // Instance\n  var _self = {};\n\n  // Library\n  var _loadableHash = {};\n\n  // Progress\n  var _loadingList = [];\n  var _completedList = [];\n\n  /**\n   * A loaded resource, adds self to DOM, self manage progress\n   * \n   * @return {_Loadable} An instance\n   */\n  var _Loadable = function(src) {\n    var _deferred = $q.defer();\n\n    // Instance\n    var _loadable = {\n\n      src: src,\n\n      // Loading completion flag\n      isComplete: false,\n\n      promise: _deferred.promise,\n\n      // TODO switch to $document\n      $element: document.createElement('script')\n    };\n\n    // Build DOM element\n    _loadable.$element.src = src;\n    _loadable.$element.type = 'text/javascript';\n    _loadable.$element.async = false;\n\n    _head.insertBefore(_loadable.$element, _head.firstChild);\n\n    // Mark loading in progress\n    _loadingList.push(_loadable);\n\n    // Completion\n    _loadable.$element.onload = _loadable.$element.onreadystatechange = function() {\n\n      if(!_loadable.isComplete && (!this.readyState || this.readyState === \"loaded\" || this.readyState === \"complete\")) {\n        _loadable.isComplete = true;\n        _loadable.$element.onload = _loadable.$element.onreadystatechange = null;\n        \n        if(_head && _loadable.$element.parentNode) {\n          _head.removeChild(_loadable.$element);\n        }\n\n        // Mark complete\n        var i = _loadingList.indexOf(_loadable);\n        if(i !== -1) {\n          _loadingList.splice(i, 1);\n        }\n        _completedList.push(_loadable);\n\n        _deferred.resolve(_loadable);\n      }\n    };\n\n    return _loadable;\n  };\n\n  /**\n   * Get progress\n   * \n   * @return {Number} A number 0..1 denoting progress\n   */\n  var _getProgress = function() {\n    var loaded = _loadingList.length;\n    var total = _loadingList.length + _completedList.length;\n    return Math.min(1, Math.max(0, loaded/total));\n  };\n\n  /**\n   * Create a _Loadable.  Does not replace previously created instances.  \n   * \n   * @param  {String}    src A source path for script asset\n   * @return {_Loadable}     A loadable instance\n   */\n  var _createLoadable = function(src) {\n    var loadable;\n\n    // Valid state name required\n    if(!src || src === '') {\n      var error;\n      error = new Error('Loadable requires a valid source.');\n      error.code = 'invalidname';\n      throw error;\n    }\n\n    // Already exists\n    if(_loadableHash[src]) {\n      loadable = _loadableHash[src];\n\n    // Create new\n    } else {\n      // Create new instance\n      loadable = new _Loadable(src);\n      _loadableHash[src] = loadable;\n\n      // Broadcast creation, progress\n      $rootScope.$broadcast('$loadableCreated', loadable);\n      $rootScope.$broadcast('$loadableProgress', _getProgress());\n\n      // Completion\n      loadable.promise.then(function() {\n\n        // Broadcast complete\n        $rootScope.$broadcast('$loadableProgress', _getProgress());\n        if(_loadingList.length === 0) {\n          $rootScope.$broadcast('$loadableComplete', loadable);\n        }\n      });\n    }\n\n    return loadable;\n  };\n\n  /**\n   * Load all required items\n   * \n   * @return {Promise} A promise fulfilled when the resources are loaded\n   */\n  var _load = function() {\n    var deferred = $q.defer();\n\n    var current = $state.current();\n\n    // Evaluate\n    if(current) {\n      var sources = (typeof current.load === 'string' ? [current.load] : current.load) || [];\n      \n      // Get promises\n      $q.all(sources\n        .map(function(src) {\n          return _createLoadable(src);\n        })\n        .filter(function(loadable) {\n          return !loadable.isComplete;\n        })\n        .map(function(loadable) {\n          return loadable.promise;\n        })\n      )\n          .then(function() {\n            deferred.resolve();\n\n          }, function(err) {\n            $rootScope.$broadcast('$loadableError', err);\n            deferred.reject(err);\n          });\n\n    // No state\n    } else {\n      deferred.resolve();\n    }\n\n    return deferred.promise;\n  };\n  _self.$load = _load;\n\n  /**\n   * Create a loadable, get reference to existing methods\n   * \n   * @param  {String}    src A source path for script asset\n   * @return {Promise}       A promise fulfilled when the resource is loaded\n   */\n  _self.get = function(src) {\n    return _createLoadable(src).promise;\n  };\n\n  /**\n   * Get progress\n   * \n   * @return {Number} A number 0..1 denoting current progress\n   */\n  _self.progress = _getProgress;\n\n  /**\n   * Ready\n   */\n  _self.$ready = function() {\n    _head = angular.element(document.querySelector('head'))[0];\n\n    // Register middleware layer\n    $state.$use(function(request, next) {\n      next();\n\n      // Load after state change is finished to avoid collision\n      request.promise.then(function() {\n        _load();\n      });\n\n    }, 1);\n\n    // Refresh after all loadables are done\n    $rootScope.$on('$loadableComplete', function() {\n      $state.reload();\n    });\n  };\n\n  return _self;\n}];\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvaGVucnkvSG9tZVN5bmMvQ2FudmFzL3Byb2plY3RzL2FuZ3VsYXItc3RhdGUtbG9hZGFibGUvc3JjL2luZGV4LmpzIiwiL1VzZXJzL2hlbnJ5L0hvbWVTeW5jL0NhbnZhcy9wcm9qZWN0cy9hbmd1bGFyLXN0YXRlLWxvYWRhYmxlL3NyYy9zZXJ2aWNlcy9sb2FkYWJsZS1tYW5hZ2VyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7Ozs7O0FBS0EsSUFBSSxPQUFPLFdBQVcsZUFBZSxPQUFPLFlBQVksZUFBZSxPQUFPLFlBQVksUUFBUTtFQUNoRyxPQUFPLFVBQVU7Ozs7OztBQU1uQixRQUFRLE9BQU8sMEJBQTBCLENBQUM7O0dBRXZDLFFBQVEsb0JBQW9CLFFBQVE7O0dBRXBDLElBQUksQ0FBQyxvQkFBb0IsU0FBUyxrQkFBa0I7SUFDbkQsaUJBQWlCOztBQUVyQjs7QUNuQkE7Ozs7QUFJQSxPQUFPLFVBQVUsQ0FBQyxVQUFVLE1BQU0sY0FBYyxTQUFTLFFBQVEsSUFBSSxZQUFZOzs7RUFHL0UsSUFBSTs7O0VBR0osSUFBSSxRQUFROzs7RUFHWixJQUFJLGdCQUFnQjs7O0VBR3BCLElBQUksZUFBZTtFQUNuQixJQUFJLGlCQUFpQjs7Ozs7OztFQU9yQixJQUFJLFlBQVksU0FBUyxLQUFLO0lBQzVCLElBQUksWUFBWSxHQUFHOzs7SUFHbkIsSUFBSSxZQUFZOztNQUVkLEtBQUs7OztNQUdMLFlBQVk7O01BRVosU0FBUyxVQUFVOzs7TUFHbkIsVUFBVSxTQUFTLGNBQWM7Ozs7SUFJbkMsVUFBVSxTQUFTLE1BQU07SUFDekIsVUFBVSxTQUFTLE9BQU87SUFDMUIsVUFBVSxTQUFTLFFBQVE7O0lBRTNCLE1BQU0sYUFBYSxVQUFVLFVBQVUsTUFBTTs7O0lBRzdDLGFBQWEsS0FBSzs7O0lBR2xCLFVBQVUsU0FBUyxTQUFTLFVBQVUsU0FBUyxxQkFBcUIsV0FBVzs7TUFFN0UsR0FBRyxDQUFDLFVBQVUsZUFBZSxDQUFDLEtBQUssY0FBYyxLQUFLLGVBQWUsWUFBWSxLQUFLLGVBQWUsYUFBYTtRQUNoSCxVQUFVLGFBQWE7UUFDdkIsVUFBVSxTQUFTLFNBQVMsVUFBVSxTQUFTLHFCQUFxQjs7UUFFcEUsR0FBRyxTQUFTLFVBQVUsU0FBUyxZQUFZO1VBQ3pDLE1BQU0sWUFBWSxVQUFVOzs7O1FBSTlCLElBQUksSUFBSSxhQUFhLFFBQVE7UUFDN0IsR0FBRyxNQUFNLENBQUMsR0FBRztVQUNYLGFBQWEsT0FBTyxHQUFHOztRQUV6QixlQUFlLEtBQUs7O1FBRXBCLFVBQVUsUUFBUTs7OztJQUl0QixPQUFPOzs7Ozs7OztFQVFULElBQUksZUFBZSxXQUFXO0lBQzVCLElBQUksU0FBUyxhQUFhO0lBQzFCLElBQUksUUFBUSxhQUFhLFNBQVMsZUFBZTtJQUNqRCxPQUFPLEtBQUssSUFBSSxHQUFHLEtBQUssSUFBSSxHQUFHLE9BQU87Ozs7Ozs7OztFQVN4QyxJQUFJLGtCQUFrQixTQUFTLEtBQUs7SUFDbEMsSUFBSTs7O0lBR0osR0FBRyxDQUFDLE9BQU8sUUFBUSxJQUFJO01BQ3JCLElBQUk7TUFDSixRQUFRLElBQUksTUFBTTtNQUNsQixNQUFNLE9BQU87TUFDYixNQUFNOzs7O0lBSVIsR0FBRyxjQUFjLE1BQU07TUFDckIsV0FBVyxjQUFjOzs7V0FHcEI7O01BRUwsV0FBVyxJQUFJLFVBQVU7TUFDekIsY0FBYyxPQUFPOzs7TUFHckIsV0FBVyxXQUFXLG9CQUFvQjtNQUMxQyxXQUFXLFdBQVcscUJBQXFCOzs7TUFHM0MsU0FBUyxRQUFRLEtBQUssV0FBVzs7O1FBRy9CLFdBQVcsV0FBVyxxQkFBcUI7UUFDM0MsR0FBRyxhQUFhLFdBQVcsR0FBRztVQUM1QixXQUFXLFdBQVcscUJBQXFCOzs7OztJQUtqRCxPQUFPOzs7Ozs7OztFQVFULElBQUksUUFBUSxXQUFXO0lBQ3JCLElBQUksV0FBVyxHQUFHOztJQUVsQixJQUFJLFVBQVUsT0FBTzs7O0lBR3JCLEdBQUcsU0FBUztNQUNWLElBQUksVUFBVSxDQUFDLE9BQU8sUUFBUSxTQUFTLFdBQVcsQ0FBQyxRQUFRLFFBQVEsUUFBUSxTQUFTOzs7TUFHcEYsR0FBRyxJQUFJO1NBQ0osSUFBSSxTQUFTLEtBQUs7VUFDakIsT0FBTyxnQkFBZ0I7O1NBRXhCLE9BQU8sU0FBUyxVQUFVO1VBQ3pCLE9BQU8sQ0FBQyxTQUFTOztTQUVsQixJQUFJLFNBQVMsVUFBVTtVQUN0QixPQUFPLFNBQVM7OztXQUdmLEtBQUssV0FBVztZQUNmLFNBQVM7O2FBRVIsU0FBUyxLQUFLO1lBQ2YsV0FBVyxXQUFXLGtCQUFrQjtZQUN4QyxTQUFTLE9BQU87Ozs7V0FJakI7TUFDTCxTQUFTOzs7SUFHWCxPQUFPLFNBQVM7O0VBRWxCLE1BQU0sUUFBUTs7Ozs7Ozs7RUFRZCxNQUFNLE1BQU0sU0FBUyxLQUFLO0lBQ3hCLE9BQU8sZ0JBQWdCLEtBQUs7Ozs7Ozs7O0VBUTlCLE1BQU0sV0FBVzs7Ozs7RUFLakIsTUFBTSxTQUFTLFdBQVc7SUFDeEIsUUFBUSxRQUFRLFFBQVEsU0FBUyxjQUFjLFNBQVM7OztJQUd4RCxPQUFPLEtBQUssU0FBUyxTQUFTLE1BQU07TUFDbEM7OztNQUdBLFFBQVEsUUFBUSxLQUFLLFdBQVc7UUFDOUI7OztPQUdEOzs7SUFHSCxXQUFXLElBQUkscUJBQXFCLFdBQVc7TUFDN0MsT0FBTzs7OztFQUlYLE9BQU87O0FBRVQiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiJ3VzZSBzdHJpY3QnO1xuXG4vKiBnbG9iYWwgYW5ndWxhcjpmYWxzZSAqL1xuXG4vLyBDb21tb25KU1xuaWYgKHR5cGVvZiBtb2R1bGUgIT09IFwidW5kZWZpbmVkXCIgJiYgdHlwZW9mIGV4cG9ydHMgIT09IFwidW5kZWZpbmVkXCIgJiYgbW9kdWxlLmV4cG9ydHMgPT09IGV4cG9ydHMpe1xuICBtb2R1bGUuZXhwb3J0cyA9ICdhbmd1bGFyLXN0YXRlLWxvYWRhYmxlJztcbn1cblxuLy8gQXNzdW1lIHBvbHlmaWxsIHVzZWQgaW4gU3RhdGVSb3V0ZXIgZXhpc3RzXG5cbi8vIEluc3RhbnRpYXRlIG1vZHVsZVxuYW5ndWxhci5tb2R1bGUoJ2FuZ3VsYXItc3RhdGUtbG9hZGFibGUnLCBbJ2FuZ3VsYXItc3RhdGUtcm91dGVyJ10pXG5cbiAgLmZhY3RvcnkoJyRsb2FkYWJsZU1hbmFnZXInLCByZXF1aXJlKCcuL3NlcnZpY2VzL2xvYWRhYmxlLW1hbmFnZXInKSlcblxuICAucnVuKFsnJGxvYWRhYmxlTWFuYWdlcicsIGZ1bmN0aW9uKCRsb2FkYWJsZU1hbmFnZXIpIHtcbiAgICAkbG9hZGFibGVNYW5hZ2VyLiRyZWFkeSgpO1xuICB9XSk7XG4iLCIndXNlIHN0cmljdCc7XG5cbi8qIGdsb2JhbCBkb2N1bWVudDpmYWxzZSAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IFsnJHN0YXRlJywgJyRxJywgJyRyb290U2NvcGUnLCBmdW5jdGlvbigkc3RhdGUsICRxLCAkcm9vdFNjb3BlKSB7XG5cbiAgLy8gRE9NIHRhcmdldFxuICB2YXIgX2hlYWQ7XG5cbiAgLy8gSW5zdGFuY2VcbiAgdmFyIF9zZWxmID0ge307XG5cbiAgLy8gTGlicmFyeVxuICB2YXIgX2xvYWRhYmxlSGFzaCA9IHt9O1xuXG4gIC8vIFByb2dyZXNzXG4gIHZhciBfbG9hZGluZ0xpc3QgPSBbXTtcbiAgdmFyIF9jb21wbGV0ZWRMaXN0ID0gW107XG5cbiAgLyoqXG4gICAqIEEgbG9hZGVkIHJlc291cmNlLCBhZGRzIHNlbGYgdG8gRE9NLCBzZWxmIG1hbmFnZSBwcm9ncmVzc1xuICAgKiBcbiAgICogQHJldHVybiB7X0xvYWRhYmxlfSBBbiBpbnN0YW5jZVxuICAgKi9cbiAgdmFyIF9Mb2FkYWJsZSA9IGZ1bmN0aW9uKHNyYykge1xuICAgIHZhciBfZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgLy8gSW5zdGFuY2VcbiAgICB2YXIgX2xvYWRhYmxlID0ge1xuXG4gICAgICBzcmM6IHNyYyxcblxuICAgICAgLy8gTG9hZGluZyBjb21wbGV0aW9uIGZsYWdcbiAgICAgIGlzQ29tcGxldGU6IGZhbHNlLFxuXG4gICAgICBwcm9taXNlOiBfZGVmZXJyZWQucHJvbWlzZSxcblxuICAgICAgLy8gVE9ETyBzd2l0Y2ggdG8gJGRvY3VtZW50XG4gICAgICAkZWxlbWVudDogZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JylcbiAgICB9O1xuXG4gICAgLy8gQnVpbGQgRE9NIGVsZW1lbnRcbiAgICBfbG9hZGFibGUuJGVsZW1lbnQuc3JjID0gc3JjO1xuICAgIF9sb2FkYWJsZS4kZWxlbWVudC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgX2xvYWRhYmxlLiRlbGVtZW50LmFzeW5jID0gZmFsc2U7XG5cbiAgICBfaGVhZC5pbnNlcnRCZWZvcmUoX2xvYWRhYmxlLiRlbGVtZW50LCBfaGVhZC5maXJzdENoaWxkKTtcblxuICAgIC8vIE1hcmsgbG9hZGluZyBpbiBwcm9ncmVzc1xuICAgIF9sb2FkaW5nTGlzdC5wdXNoKF9sb2FkYWJsZSk7XG5cbiAgICAvLyBDb21wbGV0aW9uXG4gICAgX2xvYWRhYmxlLiRlbGVtZW50Lm9ubG9hZCA9IF9sb2FkYWJsZS4kZWxlbWVudC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcblxuICAgICAgaWYoIV9sb2FkYWJsZS5pc0NvbXBsZXRlICYmICghdGhpcy5yZWFkeVN0YXRlIHx8IHRoaXMucmVhZHlTdGF0ZSA9PT0gXCJsb2FkZWRcIiB8fCB0aGlzLnJlYWR5U3RhdGUgPT09IFwiY29tcGxldGVcIikpIHtcbiAgICAgICAgX2xvYWRhYmxlLmlzQ29tcGxldGUgPSB0cnVlO1xuICAgICAgICBfbG9hZGFibGUuJGVsZW1lbnQub25sb2FkID0gX2xvYWRhYmxlLiRlbGVtZW50Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGw7XG4gICAgICAgIFxuICAgICAgICBpZihfaGVhZCAmJiBfbG9hZGFibGUuJGVsZW1lbnQucGFyZW50Tm9kZSkge1xuICAgICAgICAgIF9oZWFkLnJlbW92ZUNoaWxkKF9sb2FkYWJsZS4kZWxlbWVudCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBNYXJrIGNvbXBsZXRlXG4gICAgICAgIHZhciBpID0gX2xvYWRpbmdMaXN0LmluZGV4T2YoX2xvYWRhYmxlKTtcbiAgICAgICAgaWYoaSAhPT0gLTEpIHtcbiAgICAgICAgICBfbG9hZGluZ0xpc3Quc3BsaWNlKGksIDEpO1xuICAgICAgICB9XG4gICAgICAgIF9jb21wbGV0ZWRMaXN0LnB1c2goX2xvYWRhYmxlKTtcblxuICAgICAgICBfZGVmZXJyZWQucmVzb2x2ZShfbG9hZGFibGUpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4gX2xvYWRhYmxlO1xuICB9O1xuXG4gIC8qKlxuICAgKiBHZXQgcHJvZ3Jlc3NcbiAgICogXG4gICAqIEByZXR1cm4ge051bWJlcn0gQSBudW1iZXIgMC4uMSBkZW5vdGluZyBwcm9ncmVzc1xuICAgKi9cbiAgdmFyIF9nZXRQcm9ncmVzcyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBsb2FkZWQgPSBfbG9hZGluZ0xpc3QubGVuZ3RoO1xuICAgIHZhciB0b3RhbCA9IF9sb2FkaW5nTGlzdC5sZW5ndGggKyBfY29tcGxldGVkTGlzdC5sZW5ndGg7XG4gICAgcmV0dXJuIE1hdGgubWluKDEsIE1hdGgubWF4KDAsIGxvYWRlZC90b3RhbCkpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBfTG9hZGFibGUuICBEb2VzIG5vdCByZXBsYWNlIHByZXZpb3VzbHkgY3JlYXRlZCBpbnN0YW5jZXMuICBcbiAgICogXG4gICAqIEBwYXJhbSAge1N0cmluZ30gICAgc3JjIEEgc291cmNlIHBhdGggZm9yIHNjcmlwdCBhc3NldFxuICAgKiBAcmV0dXJuIHtfTG9hZGFibGV9ICAgICBBIGxvYWRhYmxlIGluc3RhbmNlXG4gICAqL1xuICB2YXIgX2NyZWF0ZUxvYWRhYmxlID0gZnVuY3Rpb24oc3JjKSB7XG4gICAgdmFyIGxvYWRhYmxlO1xuXG4gICAgLy8gVmFsaWQgc3RhdGUgbmFtZSByZXF1aXJlZFxuICAgIGlmKCFzcmMgfHwgc3JjID09PSAnJykge1xuICAgICAgdmFyIGVycm9yO1xuICAgICAgZXJyb3IgPSBuZXcgRXJyb3IoJ0xvYWRhYmxlIHJlcXVpcmVzIGEgdmFsaWQgc291cmNlLicpO1xuICAgICAgZXJyb3IuY29kZSA9ICdpbnZhbGlkbmFtZSc7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG5cbiAgICAvLyBBbHJlYWR5IGV4aXN0c1xuICAgIGlmKF9sb2FkYWJsZUhhc2hbc3JjXSkge1xuICAgICAgbG9hZGFibGUgPSBfbG9hZGFibGVIYXNoW3NyY107XG5cbiAgICAvLyBDcmVhdGUgbmV3XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIENyZWF0ZSBuZXcgaW5zdGFuY2VcbiAgICAgIGxvYWRhYmxlID0gbmV3IF9Mb2FkYWJsZShzcmMpO1xuICAgICAgX2xvYWRhYmxlSGFzaFtzcmNdID0gbG9hZGFibGU7XG5cbiAgICAgIC8vIEJyb2FkY2FzdCBjcmVhdGlvbiwgcHJvZ3Jlc3NcbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnJGxvYWRhYmxlQ3JlYXRlZCcsIGxvYWRhYmxlKTtcbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnJGxvYWRhYmxlUHJvZ3Jlc3MnLCBfZ2V0UHJvZ3Jlc3MoKSk7XG5cbiAgICAgIC8vIENvbXBsZXRpb25cbiAgICAgIGxvYWRhYmxlLnByb21pc2UudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICAvLyBCcm9hZGNhc3QgY29tcGxldGVcbiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCckbG9hZGFibGVQcm9ncmVzcycsIF9nZXRQcm9ncmVzcygpKTtcbiAgICAgICAgaWYoX2xvYWRpbmdMaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnJGxvYWRhYmxlQ29tcGxldGUnLCBsb2FkYWJsZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBsb2FkYWJsZTtcbiAgfTtcblxuICAvKipcbiAgICogTG9hZCBhbGwgcmVxdWlyZWQgaXRlbXNcbiAgICogXG4gICAqIEByZXR1cm4ge1Byb21pc2V9IEEgcHJvbWlzZSBmdWxmaWxsZWQgd2hlbiB0aGUgcmVzb3VyY2VzIGFyZSBsb2FkZWRcbiAgICovXG4gIHZhciBfbG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICB2YXIgY3VycmVudCA9ICRzdGF0ZS5jdXJyZW50KCk7XG5cbiAgICAvLyBFdmFsdWF0ZVxuICAgIGlmKGN1cnJlbnQpIHtcbiAgICAgIHZhciBzb3VyY2VzID0gKHR5cGVvZiBjdXJyZW50LmxvYWQgPT09ICdzdHJpbmcnID8gW2N1cnJlbnQubG9hZF0gOiBjdXJyZW50LmxvYWQpIHx8IFtdO1xuICAgICAgXG4gICAgICAvLyBHZXQgcHJvbWlzZXNcbiAgICAgICRxLmFsbChzb3VyY2VzXG4gICAgICAgIC5tYXAoZnVuY3Rpb24oc3JjKSB7XG4gICAgICAgICAgcmV0dXJuIF9jcmVhdGVMb2FkYWJsZShzcmMpO1xuICAgICAgICB9KVxuICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uKGxvYWRhYmxlKSB7XG4gICAgICAgICAgcmV0dXJuICFsb2FkYWJsZS5pc0NvbXBsZXRlO1xuICAgICAgICB9KVxuICAgICAgICAubWFwKGZ1bmN0aW9uKGxvYWRhYmxlKSB7XG4gICAgICAgICAgcmV0dXJuIGxvYWRhYmxlLnByb21pc2U7XG4gICAgICAgIH0pXG4gICAgICApXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG5cbiAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnJGxvYWRhYmxlRXJyb3InLCBlcnIpO1xuICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XG4gICAgICAgICAgfSk7XG5cbiAgICAvLyBObyBzdGF0ZVxuICAgIH0gZWxzZSB7XG4gICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gIH07XG4gIF9zZWxmLiRsb2FkID0gX2xvYWQ7XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIGxvYWRhYmxlLCBnZXQgcmVmZXJlbmNlIHRvIGV4aXN0aW5nIG1ldGhvZHNcbiAgICogXG4gICAqIEBwYXJhbSAge1N0cmluZ30gICAgc3JjIEEgc291cmNlIHBhdGggZm9yIHNjcmlwdCBhc3NldFxuICAgKiBAcmV0dXJuIHtQcm9taXNlfSAgICAgICBBIHByb21pc2UgZnVsZmlsbGVkIHdoZW4gdGhlIHJlc291cmNlIGlzIGxvYWRlZFxuICAgKi9cbiAgX3NlbGYuZ2V0ID0gZnVuY3Rpb24oc3JjKSB7XG4gICAgcmV0dXJuIF9jcmVhdGVMb2FkYWJsZShzcmMpLnByb21pc2U7XG4gIH07XG5cbiAgLyoqXG4gICAqIEdldCBwcm9ncmVzc1xuICAgKiBcbiAgICogQHJldHVybiB7TnVtYmVyfSBBIG51bWJlciAwLi4xIGRlbm90aW5nIGN1cnJlbnQgcHJvZ3Jlc3NcbiAgICovXG4gIF9zZWxmLnByb2dyZXNzID0gX2dldFByb2dyZXNzO1xuXG4gIC8qKlxuICAgKiBSZWFkeVxuICAgKi9cbiAgX3NlbGYuJHJlYWR5ID0gZnVuY3Rpb24oKSB7XG4gICAgX2hlYWQgPSBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaGVhZCcpKVswXTtcblxuICAgIC8vIFJlZ2lzdGVyIG1pZGRsZXdhcmUgbGF5ZXJcbiAgICAkc3RhdGUuJHVzZShmdW5jdGlvbihyZXF1ZXN0LCBuZXh0KSB7XG4gICAgICBuZXh0KCk7XG5cbiAgICAgIC8vIExvYWQgYWZ0ZXIgc3RhdGUgY2hhbmdlIGlzIGZpbmlzaGVkIHRvIGF2b2lkIGNvbGxpc2lvblxuICAgICAgcmVxdWVzdC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIF9sb2FkKCk7XG4gICAgICB9KTtcblxuICAgIH0sIDEpO1xuXG4gICAgLy8gUmVmcmVzaCBhZnRlciBhbGwgbG9hZGFibGVzIGFyZSBkb25lXG4gICAgJHJvb3RTY29wZS4kb24oJyRsb2FkYWJsZUNvbXBsZXRlJywgZnVuY3Rpb24oKSB7XG4gICAgICAkc3RhdGUucmVsb2FkKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIF9zZWxmO1xufV07XG4iXX0=\n"],"sourceRoot":"/source/"}